-------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/jadederong/Documents/CRG/coliphage/13beaches-coliphage/src/dm/3-f
> ormat-mb-epi.log
  log type:  text
 opened on:  14 Jan 2016, 16:44:55

. 
. *----------------------------------------
. * 3-format-mb-epi.do
. * ben arnold
. *
. * format the Mission Bay 
. * dataset so that it can be 
. * appended to the other beaches datasets 
. * (NEEAR, Avalon, Doheny, Malibu). 
. *
. *
. * use the NEEAR data as the name template
. * 
. * version 3 (21 feb 2015)
. * retained beachcode to merge to water quality data
. *
. * version 2 (13 nov 2014)
. * final data cleaning
. *
. * version 1 (17 july 2014)
. *
. *----------------------------------------
. 
. *----------------------------------------
. * input files:
. *       mb_analysis_final.dta
. *
. * output files:
. *       mb-epi.dta
. *
. *----------------------------------------
. 
. 
. *----------------------------------------
. * read in the Mission Bay Analysis data
. *----------------------------------------
. 
. 
. use "~/Documents/CRG/coliphage/13beaches-data/untouched/missionbay/mb_analysis_fina
> l.dta", clear
(SD WET Microbiolgoical Data)

. 
. 
. * drop individuals with no follow-up data
. keep if catiyn==1
(3,672 observations deleted)

. 
. 
. *----------------------------------------
. * rename variables and subset to be
. * consistent with the NEEAR data
. *----------------------------------------
. 
. 
. 
. 
. * make unique household and individual IDs
. capture drop beach

. gen beach = "MissionBay"

.         label var beach "Beach"

.         
. rename hhid hhid2

. gen hhid = string(hhid2)

.         label var hhid "Household ID"

. 
. gen indid = string(fullid,"%9.0f")

.         label var indid "Individual ID"

. 
. order beach hhid indid

. 
. rename sdate intdate

.         label var intdate "Beach interview date"

. 
. gen _m = floor(catidate/1000000)
(246 missing values generated)

. gen _d = floor(catidate/10000)- _m*100
(246 missing values generated)

. gen _y = catidate-(_m*1000000)-(_d*10000)
(246 missing values generated)

. gen teledate = mdy(_m,_d,_y)
(246 missing values generated)

.         format teledate %d

.         label var teledate "Phone interview date"

.         drop _m _d _y

. 
. 
. label var age "age in years"

. 
. * Not Measured: algaemouth
. * Not Measured: algaewash
. 
. rename allergies allergy

.         label var allergy "Has allergies"

. 
. rename saq16a anim_base

. rename oact_a anim_int

.         label var anim_int "Person: contact with animals"

. gen anim_any = (anim_base==1)|(anim_int==1)

.         label var anim_any "Any animal contact"

.         
. rename water anycontact

.         label var anycontact "Any contact with water"

. 
. * Note: for Mission bay, cannot separate out medication use by OTC vs. prescription
. * any medication use (either OTC or prescription) is stored in the common OTC varia
> bles
. rename gh8_h anyotcmeds_ear

.         recode anyotcmeds_ear (5=0)
(anyotcmeds_ear: 85 changes made)

.         label var anyotcmeds_ear "Used OTC medications for syndrome (Ear_infec)"

. rename gh7_h anyotcmeds_eye

.         recode anyotcmeds_eye (5=0)
(anyotcmeds_eye: 237 changes made)

.         label var anyotcmeds_eye "Used OTC medications for syndrome (Eye_infec)"

. 
. gen anyotcmeds_gas = (gh12_h==1) | (gh13_h==1) | (gh14_h==1) | (gh15_h==1)

.         replace anyotcmeds_gas = . if (gh12_h==.) & (gh13_h==.) & (gh14_h==.) & (gh
> 15_h==.)
(8,075 real changes made, 8,075 to missing)

.         label var anyotcmeds_gas "Used OTC medications for syndrome (GI_illness)"

.         
. gen anyotcmeds_res = (gh16_h==1) | (gh17_h==1) | (gh18_h==1) | (gh19_h==1)

.         replace anyotcmeds_res = . if (gh16_h==.) & (gh17_h==.) & (gh18_h==.) & (gh
> 19_h==.)
(7,849 real changes made, 7,849 to missing)

.         label var anyotcmeds_res "Used OTC medications for syndrome (Respiratory)"

. rename gh10_h anyotcmeds_skn

.         recode anyotcmeds_skn (5=0)
(anyotcmeds_skn: 187 changes made)

.         label var anyotcmeds_skn "Used OTC medications for syndrome (Skin_Rash)"

.         
. * Not Measured: aanyotcmeds_uti
. * Not Measured: aanyprescrdrug_ear
. * Not Measured: aanyprescrdrug_eye
. * Not Measured: aanyprescrdrug_gas
. * Not Measured: aanyprescrdrug_res
. * Not Measured: aanyprescrdrug_skn
. * Not Measured: aanyprescrdrug_uti
. 
. rename chronresp asth

.         label var asth "chronic respiratory problems"

. 
. * Not Measured: berm
. 
. drop block

. rename saq8b block

.         label var block "Wear sunscreen-block today (R)"

. 
. rename water_shoulders bodycontact

.         label var bodycontact "Body contact with water"

. 
. rename buried bsand

.         label var bsand "Had body buried in sand (R)"

. 
. * Not Measured: cold
. * Not Measured: coldallergy
. * Not Measured: colddays
. * Not Measured: coldstdt
. * Not Measured: coldstill
. 
. * Not Measured: come
. 
. * cough is measured 2 ways in MB. combine into one, using the min(start date)
. rename cough cough2

. gen cough = (cough2==1) | (cough_phlegm==1)

.         replace cough = . if (cough2==.) & (cough_phlegm==.)
(46 real changes made, 46 to missing)

.         label var cough "Person had cough"

. 
.         * clean 3 values with impossible months
.         replace gh16_b1 = 5 if gh16_b1<5 & gh16_b1!=.
(3 real changes made)

. gen coughdt1 = mdy(gh16_b1,gh16_b2,2003)
(8,527 missing values generated)

. gen coughdt2 = mdy(gh17_b1,gh17_b2,2003)
(8,584 missing values generated)

. gen coughstdt = min(coughdt1,coughdt2)
(8,368 missing values generated)

.         drop coughdt1 coughdt2

.         format coughstdt %d

.         label var coughstdt "cough start date"

. 
. * Not Measured: coughallergy
. * Not Measured: coughdays
. * Not Measured: coughstill
. 
. rename scrapes cut

. rename saq12 cutbase

.         label var cutbase "Cut self or have open cut (R)"

. gen cutstdt = mdy(gh11_b1,gh11_b2,2003)
(8,764 missing values generated)

.         format cutstdt %d

.         label var cutstdt "cut start date"

. * Not Measured: cutdays
. * Not Measured: cutstill
. 
. 
. gen diarrheastdt = mdy(gh14_b1,gh14_b2,2003)
(8,423 missing values generated)

.         format diarrheastdt %d

.         label var diarrheastdt "diarrhea start date"

. * Not Measured: diarrheadays
. * Not Measured: diarrheanumber
. * Not Measured: diarrheastill
. 
. * clean 1 apparent data entry error in the diarrhea start date
. replace diarrheastdt = mdy(6,1,2003) if indid=="40004601"
(1 real change made)

. 
. gen differentbeach = (sw1c_c>0 & sw1c_c!=. & sw1c_c!=98) | (sw1d_c>0 & sw1d_c!=. & 
> sw1d_c!=98)

.         label var differentbeach "Summary variable: swam at other beach"

.         
. rename saq11 drinksy

.         recode drinksy (2=0)
(drinksy: 7726 changes made)

. 
. * note: sunhr and sunmin not calculable for Mission Bay -- only collected as catego
> rical data
. * create sunhr_cat rather than sunhr
. rename saq9b sunhr_cat

.         label var sunhr_cat "Total hours in direct sunlight (category)"

.         
. * Not Measured: sunmin  
. 
. 
. * earache and ear discharge need to be combined.  combine into one, using the min(s
> tart date)
. rename earache earache2

. gen earache = (earache2==1) | (ear_discharge==1)

.         replace earache = . if (earache2==.) & (ear_discharge==.)
(46 real changes made, 46 to missing)

.         label var earache "Person had earache/infection/runny ears since beach inte
> rview"

. 
. gen eardt1 = mdy(gh8_b1,gh9_b2,2003)
(8,771 missing values generated)

. gen eardt2 = mdy(gh9_b1,gh9_b2,2003)
(8,759 missing values generated)

. gen earachestdt = min(eardt1,eardt2)
(8,759 missing values generated)

.         drop eardt1 eardt2

.         format earachestdt %d

.         label var earachestdt "earache start date"

.         
. * Not Measured: earacheallergy
. * Not Measured: earachedays
. * Not Measured: earachestill
. 
. rename saq6a earplugs

. 
. rename saq10 eatfood

. 
. 
. rename saq15b eggs_base

. rename food_b eggs_int

.         label var eggs_int "Person:eaten runny/raw eggs since interview"

. drop eggs_any

. gen eggs_any = (eggs_base==1)|(eggs_int==1)

.         label var eggs_any "Any undercooked eggs"

. 
. * Not Measured: emergencyroom_ear
. * Not Measured: emergencyroom_eye
. * Not Measured: emergencyroom_gas
. * Not Measured: emergencyroom_res
. * Not Measured: emergencyroom_skn
. * Not Measured: emergencyroom_uti
. 
. rename eye_infection_past eyebase

.         label var eyebase "Eye infection at baseline"

. 
. rename eye_irritation eyeinfection

.         * recode 1 implausible value
.         replace gh7_b2 = 26 if gh7_b2==1 & gh7_b1==1
(1 real change made)

.         replace gh7_b1 = 5 if gh7_b1==1
(1 real change made)

. gen eyeinfectionstdt = mdy(gh7_b1,gh7_b2,2003)
(8,382 missing values generated)

.         format eyeinfectionstdt %d

.         label var eyeinfectionstdt "eye infection start date"

. 
. * Not Measured: eyeinfectiondays
. * Not Measured: eyeinfectionstill
. 
. gen feverstdt = mdy(gh5_b1,gh5_b2,2003)
(8,485 missing values generated)

.         format feverstdt %d

.         label var feverstdt "fever start date"

.         
. * Not Measured: feverdays
. * Not Measured: feverstill
. * Not Measured: fevertemp
. * Not Measured: fevertemptaken
. 
. rename food_e fish_int

.         recode fish_int (5=0)
(fish_int: 7980 changes made)

. rename saq15g fish_base

. gen fish_any = (fish_base==1)|(fish_int==1)

.         label var fish_any "Any raw fish"

. 
. 
. rename saq10a food

. 
. gen gibase = (diarrhea_past==1) | (vomiting_past==1)

.         label var gibase "GI illness at baseline"

.         * flag 1 individual who reported GI symptoms before the interview date
.         replace gibase=1 if indid=="20002502"
(1 real change made)

. 
. 
. rename chrongi gichron

.         label var gichron "Chronic GI problems/Crohn's/IBS"

.         * assume that the large number of individuals with missing values (3703) do
>  not have chronic GI problems
.         replace gichron = 0 if gichron==.
(31 real changes made)

. 
. drop gicontact

. rename saq16b gicontact_base

. 
. * Not Measured: groundwater
. 
. * Not Measured: headache
. * Not Measured: headachedays
. * Not Measured: headachestdt
. * Not Measured: headachestill
. 
. rename water_face_under headunder

.         label var headunder "Head under water"

. 
. 
. * household income at MB uses different categories
. * create hhinc_mb
. rename isum hhinc_mb

.         label var hhinc_mb "Household Pre-tax income, 2002 (Mission Bay categories)
> "

. 
. * Not Measured: hospitaldays_ear
. * Not Measured: hospitaldays_eye
. * Not Measured: hospitaldays_gas
. * Not Measured: hospitaldays_res
. * Not Measured: hospitaldays_skn
. * Not Measured: hospitaldays_uti
. 
. * Not Measured: hospitalized_ear
. * Not Measured: hospitalized_eye
. * Not Measured: hospitalized_gas
. * Not Measured: hospitalized_res
. * Not Measured: hospitalized_skn
. * Not Measured: hospitalized_uti
. 
. rename saq6d mask

. 
. rename water_mouth mouthwater

. 
. gen nauseastdt = mdy(gh12_b1,gh12_b2,2003)
(8,574 missing values generated)

.         format nauseastdt %d

.         label var nauseastdt "nausea start date"

.         
. * Not Measured: nauseadays
. * Not Measured: nauseastill
. 
. rename saq6b noseplugs

. 
. * Not Measured: othersmiss_ear
. * Not Measured: othersmiss_eye
. * Not Measured: othersmiss_gas
. * Not Measured: othersmiss_res
. * Not Measured: othersmiss_skn
. * Not Measured: othersmiss_uti
. * Not Measured: othersmissdays_ear
. * Not Measured: othersmissdays_eye
. * Not Measured: othersmissdays_gas
. * Not Measured: othersmissdays_res
. * Not Measured: othersmissdays_skn
. * Not Measured: othersmissdays_uti      
. 
. * Not Measured: ownmoneyfordrugs_ear
. * Not Measured: ownmoneyfordrugs_eye
. * Not Measured: ownmoneyfordrugs_gas
. * Not Measured: ownmoneyfordrugs_res
. * Not Measured: ownmoneyfordrugs_skn
. * Not Measured: ownmoneyfordrugs_uti
. * Not Measured: ownmoneyforotc_ear
. * Not Measured: ownmoneyforotc_eye
. * Not Measured: ownmoneyforotc_gas
. * Not Measured: ownmoneyforotc_res
. * Not Measured: ownmoneyforotc_skn
. * Not Measured: ownmoneyforotc_uti
. 
. * Not Measured: phonedoc_ear
. * Not Measured: phonedoc_eye
. * Not Measured: phonedoc_gas
. * Not Measured: phonedoc_res
. * Not Measured: phonedoc_skn
. * Not Measured: phonedoc_uti
. 
. * Not Measured: pool
. 
. rename gh4_a preg

. recode preg (5=0)
(preg: 3005 changes made)

. 
. rename saq8c prothat

. rename saq9a prot

. 
. rename sw2a_a publicpool

. recode publicpool (5=0)
(publicpool: 7454 changes made)

. 
. 
. * create a standardize race category consistent with other beaches
. gen byte race2 = . 
(8,797 missing values generated)

. replace race2 = 1 if race==1 & inlist(hisp,5,.)
(2,211 real changes made)

. replace race2 = 2 if race==1 & inlist(hisp,1,2,3,4)
(284 real changes made)

. replace race2 = 3 if race!=1 & (race==7 | inlist(hisp,1,2,3,4) )
(5,040 real changes made)

. replace race2 = 4 if race==2 & inlist(hisp,5,.)
(356 real changes made)

. replace race2 = 5 if race==4 & inlist(hisp,5,.)
(449 real changes made)

. replace race2 = 6 if race==3 & inlist(hisp,5,.)
(53 real changes made)

. replace race2 = 7 if race==6 & inlist(hisp,5,.)
(241 real changes made)

. replace race2 = 8 if race==5 & inlist(hisp,5,.)
(112 real changes made)

. replace race2 = 9 if race==.
(51 real changes made)

. drop race

. label drop race

. label define race 1 "white" 2 "white, hispanic" 3 "non-white, hispanic" 4 "black" 5
>  "asian" 6 "american indian" 7 "multiple races" 8 "other" 9 "missing"

. rename race2 race

. label values race race

. label var race "Racial category"

. 
. * standardize hisp var
. gen byte hisp2 = inlist(hisp,1,2,3,4) | (race==7 & hisp==5)

. drop hisp

. rename hisp2 hisp

. label var hisp "Hispanic"

. 
.         
. rename skin_rash rash

. rename rash_past rashbase

. gen rashstdt = mdy(gh10_b1,gh10_b2,2003)
(8,528 missing values generated)

.         format rashstdt %d

.         label var rashstdt "skin rash start date"

. 
. * Not Measured: rashdays
. * Not Measured: rashstill
. 
. rename food_d rawmeat_int

.         recode rawmeat_int (5=0)
(rawmeat_int: 7733 changes made)

. rename saq15d rawmeat_base

. gen rawmeat_any = (rawmeat_int==1) | (rawmeat_base==1)

.         label var rawmeat_any "Any raw meat"

. 
. gen byte rawfood = (eggs_any==1)|(fish_any==1)|(rawmeat_any==1)

.         label var rawfood "Ate undercooked eggs/meat/fish"

. 
. rename saq8a repel

. 
. rename nasal_congestion runnynose

. 
. gen runnynosestdt = mdy(gh18_b1,gh18_b2,2003)
(8,260 missing values generated)

.         format runnynosestdt %d

.         label var runnynosestdt "congestion/runny nose start date"

. 
. * Not Measured: runnynoseallergy
. * Not Measured: runnynosedays
. * Not Measured: runnynosestill
. 
. gen samebeach = (sw1a_a==1) & (sw1a_b==1)

.         label var samebeach "Swim/wade: same beach"

.         
. * Not Measured: sanddry
. * Not Measured: sandmouth
. * Not Measured: sandwash
. 
. gen shade = prot
(261 missing values generated)

.         label var shade "Use protective equipment (R)"

. 
. rename gh1_b skinchron

. recode skinchron (5=0)
(skinchron: 8289 changes made)

. 
. rename sore_throat_past sorebase

. 
. rename sore_throat sorethroat

. gen sorethroatstdt = mdy(gh19_b1,gh19_b2,2003)
(8,377 missing values generated)

.         format sorethroatstdt %d

.         label var sorethroatstdt "sore throat start date"

. 
. * Not Measured: sorethroatallergy
. * Not Measured: sorethroatdays
. * Not Measured: sorethroatstill
. 
. gen byte stayhome_ear = (gh8_d==1) | (gh9_d==1)

.         replace stayhome_ear = . if (gh8_d==.) & (gh9_d==.)
(8,703 real changes made, 8,703 to missing)

.         label var stayhome_ear "Missed work/school for syndrome (Ear_infec)"

. 
. gen byte stayhome_eye = (gh7_d==1)

.         replace stayhome_eye = . if (gh7_d==.)
(8,607 real changes made, 8,607 to missing)

.         label var stayhome_eye "Missed work/school for syndrome (Eye_infec)"

.         
. gen byte stayhome_gas = (gh12_d==1) | (gh13_d==1) | (gh14_d==1) | (gh15_d==1)

.         replace stayhome_gas = . if (gh12_d==.) & (gh13_d==.) & (gh14_d==.) & (gh15
> _d==.)
(8,495 real changes made, 8,495 to missing)

.         label var stayhome_gas "Missed work/school for syndrome (GI_illness)"

. gen byte stayhome_res = (gh16_d==1) | (gh17_d==1) | (gh18_d==1) | (gh19_d==1)

.         replace stayhome_res = . if (gh16_d==.) & (gh17_d==.) & (gh18_d==.) & (gh19
> _d==.)
(8,344 real changes made, 8,344 to missing)

. gen byte stayhome_skn = (gh10_d==1)

.         replace stayhome_skn = . if (gh10_d==.)
(8,717 real changes made, 8,717 to missing)

.         label var stayhome_skn "Missed work/school for syndrome (Skin_rash)"

. 
. * Not Measured: stayhome_uti
. 
. gen stayhomedays_ear = max(gh8_e,gh9_e)
(8,772 missing values generated)

.         label var stayhomedays_ear "Number of days missed from work/school (Ear_inf
> ec)"

. gen stayhomedays_eye = gh7_e
(8,785 missing values generated)

.         label var stayhomedays_eye "Number of days missed from work/school (Eye_inf
> ec)"

. gen stayhomedays_gas = max(gh12_e,gh13_e,gh14_e,gh15_e)
(8,726 missing values generated)

.         label var stayhomedays_gas "Number of days missed from work/school (GI_illn
> ess)"

. gen stayhomedays_res = max(gh16_e,gh17_e,gh18_e,gh19_e)
(8,739 missing values generated)

.         label var stayhomedays_res "Number of days missed from work/school (Respira
> tory)"

. gen stayhomedays_skn = gh10_e
(8,794 missing values generated)

.         label var stayhomedays_skn "Number of days missed from work/school (Skin_ra
> sh)"

.         
. * Not Measured: stayhomedays_uti
. * Not Measured: stmatch
. 
. rename cramps stomach

. gen stomachstdt = mdy(gh15_b1,gh15_b2,2003)
(8,409 missing values generated)

.         format stomachstdt %d

.         label var stomachstdt "stomach pain or cramps start date"

. 
. * Not Measured: stomachdays
. * Not Measured: stomachstill
. 
. * NOTE: In Mission Bay, these questions asked about whether an
. * individual -Limited- their daily activities due to the symptoms
. * but for the other beaches the questions asked about whether they
. * -missed- their daily activities due to the symptoms
. 
. gen byte stopdaily_ear = (gh8_f==1) | (gh9_f==1)

.         replace stopdaily_ear = . if (gh8_f==.) & (gh9_f==.)
(8,592 real changes made, 8,592 to missing)

.         label var stopdaily_ear "Missed other activities (Ear_infec)"

. gen byte stopdaily_eye = (gh7_f==1)

.         replace stopdaily_eye = . if (gh7_f==.)
(8,381 real changes made, 8,381 to missing)

.         label var stopdaily_eye "Missed other activities (Eye_infec)"

. gen byte stopdaily_gas = (gh12_f==1) | (gh13_f==1) | (gh14_f==1) | (gh15_f==1)

.         replace stopdaily_gas = . if (gh12_f==.) & (gh13_f==.) & (gh14_f==.) & (gh1
> 5_f==.)
(8,074 real changes made, 8,074 to missing)

.         label var stopdaily_gas "Missed other activities (GI_illness)"

. gen byte stopdaily_res = (gh16_f==1) | (gh17_f==1) | (gh18_f==1) | (gh19_f==1)

.         replace stopdaily_res = . if (gh16_f==.) & (gh17_f==.) & (gh18_f==.) & (gh1
> 9_f==.)
(7,848 real changes made, 7,848 to missing)

.         label var stopdaily_res "Missed other activities (Respiratory)"

. gen byte stopdaily_skn = gh10_f
(8,527 missing values generated)

.         label var stopdaily_skn "Missed other activities (Skin_rash)"

. 
. * Not Measured: stopdaily_uti
. 
. gen stopdailydays_ear = max(gh8_g,gh9_g)
(8,723 missing values generated)

.         label var stopdailydays_ear "Days missed from other activities (Ear_infec)"

. gen stopdailydays_eye = gh9_g
(8,788 missing values generated)

.         label var stopdailydays_eye "Days missed from other activities (Eye_infec)"

. gen stopdailydays_gas = max(gh12_g,gh13_g,gh14_g,gh15_g)
(8,482 missing values generated)

.         label var stopdailydays_gas "Days missed from other activities (GI_illness)
> "

. gen stopdailydays_res  = max(gh16_g,gh17_g,gh18_g,gh19_g)
(8,548 missing values generated)

.         label var stopdailydays_res "Days missed from other activities (Respiratory
> )"

. gen stopdailydays_skn = gh10_g
(8,757 missing values generated)

.         label var stopdailydays_skn "Days missed from other activities (Skin_rash)"

. 
. * Not Measured: stopdailydays_uti
. 
. rename sunburn_past sunbase

. 
. * Not Measured: sunburn
. * Not Measured: sunburndays
. * Not Measured: sunburnstdt
. * Not Measured: sunburnstill
. 
. rename water_swallow swallwater

. 
. gen swam = anycontact
(84 missing values generated)

.         label var swam "Person went swimming/wading"

. 
. * Not Measured: totdays
. 
. * Not Measured: urinarytractinfection
. * Not Measured: urinarytractinfectiondays
. * Not Measured: urinarytractinfectionstdt
. * Not Measured: urinarytractinfectionstill
. * Not Measured: utibase
. 
. 
. gen byte visitdoc_ear = (gh8_c==1) | (gh9_c==1)

.         replace visitdoc_ear = . if (gh8_c==.) & (gh9_c==.)
(8,592 real changes made, 8,592 to missing)

.         label var visitdoc_ear "Visited doctor/nurse/clinic (Ear_infec)"

. gen byte visitdoc_eye = (gh7_c==1)

.         replace visitdoc_eye = . if (gh7_c==.)
(8,381 real changes made, 8,381 to missing)

.         label var visitdoc_eye "Visited doctor/nurse/clinic (Eye_infec)"

. gen byte visitdoc_gas =  (gh12_c==1) | (gh13_c==1) | (gh14_c==1) | (gh15_c==1)

.         replace visitdoc_gas = . if (gh12_c==.) & (gh13_c==.) & (gh14_c==.) & (gh15
> _c==.)
(8,074 real changes made, 8,074 to missing)

.         label var visitdoc_gas "Visited doctor/nurse/clinic (GI_illness)"

. gen byte visitdoc_res = (gh16_c==1) | (gh17_c==1) | (gh18_c==1) | (gh19_c==1)

.         replace visitdoc_res =. if (gh16_c==.) & (gh17_c==.) & (gh18_c==.) & (gh19_
> c==.)
(7,849 real changes made, 7,849 to missing)

.         label var visitdoc_res "Visited doctor/nurse/clinic (Respiratory)"

. gen byte visitdoc_skn = (gh10_c==1)

.         replace visitdoc_skn = . if (gh10_c==.)
(8,527 real changes made, 8,527 to missing)

.         label var visitdoc_skn "Visited doctor/nurse/clinic (Skin_rash)"

. 
. * Not Measured: visitdoc_uti
. 
. * Not Measured: visitdoctimes_ear
. * Not Measured: visitdoctimes_eye
. * Not Measured: visitdoctimes_gas
. * Not Measured: visitdoctimes_res
. * Not Measured: visitdoctimes_skn
. * Not Measured: visitdoctimes_uti
. 
. * Not Measured: visitertimes_ear
. * Not Measured: visitertimes_eye
. * Not Measured: visitertimes_gas
. * Not Measured: visitertimes_res
. * Not Measured: visitertimes_skn
. * Not Measured: visitertimes_uti
. 
. rename vomiting_past vomitingbase

. gen vomitingstdt = mdy(gh13_b1,gh13_b2,2003)
(8,629 missing values generated)

.         format vomitingstdt %d

.         label var vomitingstdt "vomiting start date"

. 
. * Not Measured: vomitingdays
. * Not Measured: vomitingnumber
. * Not Measured: vomitingstill
. 
. gen watertime = water_minutes
(561 missing values generated)

.         label var watertime "Time in water (mins)"

.         replace watertime = 0 if anycontact==0
(0 real changes made)

. 
. * Not Measured: wateryeyes
. * Not Measured: wateryeyesallergy
. * Not Measured: wateryeyesdays
. * Not Measured: wateryeyesstdt
. * Not Measured: wateryeyesstill
. 
. * NOTE: in MB the wave variable only includes windsurfing and "boarding"
. gen byte wave = (saq5c==1) | (saq5f==1)

.         label var wave "boog board/wave rid/surf/windsurf/wake-kite board"

. 
. * NOTE: in MB the working variable includes persons who work or go to school
. rename work working

.         label var working "Person working for pay"

. 
. * Not Measured: beachtype
. * Not Measured: blockface
. * Not Measured: diagnosis_ear
. * Not Measured: diagnosis_eye
. * Not Measured: diagnosis_gas
. * Not Measured: diagnosis_res
. * Not Measured: diagnosis_skn
. * Not Measured: diagnosis_uti
. * Not Measured: gicontact_any
. * Not Measured: gicontact_int
. * Not Measured: lat
. * Not Measured: longi
. * Not Measured: meanbathers
. * Not Measured: miles
. 
. * Not Measured: protbrim
. * Not Measured: protslv
. * Not Measured: reapp
. * Not Measured: seatdr
. * Not Measured: spf
. * Not Measured: statusc
. 
. * Not Measured: sunburn1
. * Not Measured: sunburn2
. * Not Measured: sunburn3
. * Not Measured: sunburn4
. * Not Measured: sunburn5
. * Not Measured: sunburn6
. * Not Measured: sunburn7
. * Not Measured: sunburnother
. 
. * Not Measured: swimloc
. * Not Measured: tanning
. * Not Measured: tanos
. * Not Measured: transect
. * Not Measured: venfest
. 
. recode sex 0=2
(sex: 3948 changes made)

. label define sex 1 "Male" 2 "Female"

. label values sex sex

. 
. recode anim_int eggs_int stopdaily_skn (5=0)
(anim_int: 8380 changes made)
(eggs_int: 8272 changes made)
(stopdaily_skn: 230 changes made)

. 
. * recode variables from 2=0
. local vlist "cutbase eggs_base rawmeat_base fish_base anim_base gicontact_base skin
> chron block prothat shade repel eatfood food earplugs noseplugs mask preg publicpoo
> l fish_int rawmeat_int"

. recode `vlist' (2=0)
(cutbase: 8076 changes made)
(eggs_base: 7883 changes made)
(rawmeat_base: 7371 changes made)
(fish_base: 8313 changes made)
(anim_base: 6680 changes made)
(gicontact_base: 8249 changes made)
(skinchron: 0 changes made)
(block: 3980 changes made)
(prothat: 6531 changes made)
(shade: 5313 changes made)
(repel: 8369 changes made)
(eatfood: 1230 changes made)
(food: 985 changes made)
(earplugs: 4686 changes made)
(noseplugs: 4719 changes made)
(mask: 4563 changes made)
(preg: 0 changes made)
(publicpool: 0 changes made)
(fish_int: 0 changes made)
(rawmeat_int: 0 changes made)

. 
. 
. *----------------------------------------
. * retain the beach code to merge these
. * data to the water quality data
. *----------------------------------------
. gen beachcode = "Mission Bay " + substr(station,1,1)

.         label var beachcode "Water quality sampling location beach code"

. order beach beachcode

. 
. *----------------------------------------
. * subset the dataset to relevant variables
. *----------------------------------------
. # delimit ;
delimiter now ;
. keep beach beachcode indid hhid intdate teledate age sex 
> watertime 
> earplugs noseplugs mask
> sunhr dig bsand algae
> block prothat shade repel  
> eatfood food drinksy publicpool
> anim_base anim_int anim_any 
> gicontact_base 
> fish_base fish_int fish_any
> rawmeat_base rawmeat_int rawmeat_any
> eggs_base eggs_int eggs_any
> rawfood
> asth gichron skinchron allergy preg 
> anycontact bodycontact headunder mouthwater swallwater wave
> diarrhea nausea vomiting fever sorethroat cough runnynose earache eyeinfection cut 
> rash
> *allergy
> working 
> race hisp
> hhinc
> *_gas *_eye *_res *_ear  *_skn
> *stdt
> stopdaily_gas
> gibase cutbase sorebase eyebase rashbase
> watertime
> swam samebeach differentbeach
> 
> ;

. # delimit cr
delimiter now cr
. 
. * Retained in other datasets, but missing in Mission Bay
. * hhmem wetsuit dsun sanddry sandmouth sandwash algaemouth algaewash come pool diar
> rheanumber vomitingnumber urinarytractinfection * *_uti *still *days fevertemp* hea
> dache cold wateryeyes sunburn racehaw utibase  vomitbase earbase siteid stmatch gro
> undwater berm
. 
. 
. 
. *---------------------------------------------
. * output variable information for harmonization
. *---------------------------------------------
. preserve

. desc, replace clear

. label data "variables for mb-epi.dta"

. save "~/Documents/CRG/coliphage/13beaches-data/temp/mb-epi-vars.dta", replace
(note: file /Users/jadederong/Documents/CRG/coliphage/13beaches-data/temp/mb-epi-vars
> .dta not found)
file ~/Documents/CRG/coliphage/13beaches-data/temp/mb-epi-vars.dta saved

. restore

. 
. 
. 
. *----------------------------------------
. * save the data for combining it with
. * other beaches
. *----------------------------------------
. label data "Mission Bay epi data, created by 3-format-mb-epi.do"

. save "~/Documents/CRG/coliphage/13beaches-data/final/mb-epi.dta", replace
(note: file /Users/jadederong/Documents/CRG/coliphage/13beaches-data/final/mb-epi.dta
>  not found)
file ~/Documents/CRG/coliphage/13beaches-data/final/mb-epi.dta saved

. 
. codebook, c

Variable       Obs Unique      Mean    Min    Max  Label
-------------------------------------------------------------------------------------
beach         8797      1         .      .      .  Beach
beachcode     8797      6         .      .      .  Water quality sampling location...
hhid          8797   3425         .      .      .  Household ID
indid         8797   8797         .      .      .  Individual ID
intdate       8797     30  15907.19  15849  15949  Beach interview date
anycontact    8713      2  .5705268      0      1  Any contact with water
bodycontact   8646      2  .3745084      0      1  Body contact with water
headunder     8637      2  .3430589      0      1  Head under water
mouthwater    8611      2  .2403902      0      1  Get Water in Your Mouth
swallwater    8567      2  .1238473      0      1  Swallow Any Water
earplugs      4742      2  .0118094      0      1  WATER ITEMS: Ear Plugs
noseplugs     4742      2  .0048503      0      1  WATER ITEMS: Nose Plugs
mask          4742      2  .0377478      0      1  WATER ITEMS: Goggles or Mask
dig           8593      2   .356802      0      1  BEACH ACTIVITIES: Dig in Sand
bsand         8593      2  .0588851      0      1  Had body buried in sand (R)
algae         8593      2  .0430583      0      1  BEACH ACTIVITIES: Play with Alg...
repel         8589      2  .0256142      0      1  WEAR OR USE: Insect Repellant
block         8589      2  .5366166      0      1  Wear sunscreen-block today (R)
prothat       8589      2  .2396088      0      1  WEAR OR USE: Hat or Clothing
sunhr_cat     8397      5  2.677028      1      5  Total hours in direct sunlight ...
eatfood       8602      2    .85701      0      1  Eat Food at the Beach
food          7124      2   .861735      0      1  IF YES: Food from Home
drinksy       8569      2  .0983779      0      1  Drink Alcohol at the Beach
cutbase       8584      2  .0591799      0      1  Cut self or have open cut (R)
eggs_base     8633      2  .0868759      0      1  IF YES: Raw or Runny Eggs
rawmeat_base  8633      2  .1461833      0      1  IF YES: Meat (Medium Rare)
fish_base     8633      2  .0370671      0      1  IF YES: Raw Seafood
anim_base     8550      2  .2187135      0      1  IF YES: Contact with Animal/Feces
gicontact_~e  8550      2  .0352047      0      1  IF YES: Contact w/Lower GI Cond...
sorebase      8524      2  .0407086      0      1  PAST 3 DAYS: Sore Throat
eyebase       8524      2  .0073909      0      1  Eye infection at baseline
rashbase      8524      2  .0168935      0      1  PAST 3 DAYS: Rash
age           8648     85  24.37419      1     95  age in years
sex           8709      2  1.453324      1      2  Gender on consent form
skinchron     8772      2  .0550616      0      1  Have skin problems such as psor...
working       5513      2  .7003446      0      1  Person working for pay
preg          3143      2  .0439071      0      1  Currently pregnant
fever         8751      2  .0356531      0      1  Fever since beach interview
eyeinfection  8750      2  .0475429      0      1  Redness or eye irritation since...
anyotcmeds~e   415      2  .4289157      0      1  Used OTC medications for syndro...
anyotcmeds~r   193      2  .5595855      0      1  Used OTC medications for syndro...
rash          8750      2  .0308571      0      1  Skin rash since beach interview
anyotcmeds~n   270      2  .3074074      0      1  Used OTC medications for syndro...
cut           8751      2   .003771      0      1  Cuts or scrapes that became inf...
nausea        8746      2  .0254974      0      1  Nausea since beach interview
vomiting      8750      2     .0192      0      1  Vomiting since beach interview
diarrhea      8751      2   .042738      0      1  Diarrhea since beach interview
runnynose     8751      2  .0617072      0      1  Nasal congestion or runny nose ...
sorethroat    8750      2  .0482286      0      1  Sore throat since beach interview
publicpool    8760      2  .1490868      0      1  Swam in a private pool since be...
eggs_int      8741      2  .0536552      0      1  Person:eaten runny/raw eggs sin...
rawmeat_int   8739      2  .1151161      0      1  Ate meat red in the center sinc...
fish_int      8738      2  .0867475      0      1  Ate raw seafood since beach int...
anim_int      8753      2   .042614      0      1  Person: contact with animals
hhinc_mb      8120     19  8.105172      1     19  Household Pre-tax income, 2002 ...
allergy       8765      2  .1168283      0      1  Has allergies
gichron       8797      2  .0247812      0      1  Chronic GI problems/Crohn's/IBS
asth          8769      2     .0658      0      1  chronic respiratory problems
teledate      8551     96  15918.17  15860  15964  Phone interview date
anim_any      8797      2  .2386041      0      1  Any animal contact
anyotcmed~as   722      2   .398892      0      1  Used OTC medications for syndro...
anyotcmed~es   948      2  .5021097      0      1  Used OTC medications for syndro...
cough         8751      2  .0493658      0      1  Person had cough
coughstdt      429    112  15904.54  15826  15963  cough start date
cutstdt         33     25  15917.18  15857  15955  cut start date
diarrheastdt   374     94   15910.9  15849  15961  diarrhea start date
differentb~h  8797      2  .0551324      0      1  Summary variable: swam at other...
earache       8751      2  .0234259      0      1  Person had earache/infection/ru...
earachestdt     38     31  15903.53  15715  15960  earache start date
eggs_any      8797      2  .1282255      0      1  Any undercooked eggs
eyeinfecti~t   415     99  15907.13  15828  15962  eye infection start date
feverstdt      312    100  15912.81  15845  15963  fever start date
fish_any      8797      2  .1128794      0      1  Any raw fish
gibase        8797      2  .0243265      0      1  GI illness at baseline
nauseastdt     223     88  15908.69  15810  15958  nausea start date
race          8797      9  2.833693      1      9  Racial category
hisp          8797      2  .6282824      0      1  Hispanic
rashstdt       269     78   15913.3  15851  15958  skin rash start date
rawmeat_any   8797      2  .2254178      0      1  Any raw meat
rawfood       8797      2  .3639877      0      1  Ate undercooked eggs/meat/fish
runnynoses~t   537    106  15907.98  15826  15963  congestion/runny nose start date
samebeach     8797      2  .0422871      0      1  Swim/wade: same beach
shade         8536      2  .3775773      0      1  Use protective equipment (R)
sorethroat~t   420    107  15907.49  15826  15962  sore throat start date
stayhome_ear    94      2  .2659574      0      1  Missed work/school for syndrome...
stayhome_eye   190      2  .0631579      0      1  Missed work/school for syndrome...
stayhome_gas   302      2  .2384106      0      1  Missed work/school for syndrome...
stayhome_res   453      2  .1302428      0      1  
stayhome_skn    80      2     .0375      0      1  Missed work/school for syndrome...
stayhomeda~r    25      6      2.32      1      7  Number of days missed from work...
stayhomeda~e    12      6      3.25      1      7  Number of days missed from work...
stayhomed~as    71      8  2.070423      1     14  Number of days missed from work...
stayhomed~es    58      7   2.12069      1     13  Number of days missed from work...
stayhomeda~n     3      2  2.333333      1      5  Number of days missed from work...
stomachstdt    388    105  15910.67  15810  15962  stomach pain or cramps start date
stopdaily_~r   205      2  .3707317      0      1  Missed other activities (Ear_in...
stopdaily_~e   416      2     .1875      0      1  Missed other activities (Eye_in...
stopda~y_gas   723      2   .439834      0      1  Missed other activities (GI_ill...
stopda~y_res   949      2  .2644889      0      1  Missed other activities (Respir...
stopdaily_~n   270      2  .1481481      0      1  Missed other activities (Skin_r...
stopdailyd~r    74      9  3.175676      1     14  Days missed from other activiti...
stopdailyd~e     9      5  4.111111      2      7  Days missed from other activiti...
stopda~s_gas   315     10  2.780952      1     98  Days missed from other activiti...
stopda~s_res   249     12  3.192771      1     14  Days missed from other activiti...
stopdailyd~n    40      9     3.625      1     11  Days missed from other activiti...
swam          8713      2  .5705268      0      1  Person went swimming/wading
visitdoc_ear   205      2  .3073171      0      1  Visited doctor/nurse/clinic (Ea...
visitdoc_eye   416      2  .1538462      0      1  Visited doctor/nurse/clinic (Ey...
visitdoc_gas   723      2  .1355463      0      1  Visited doctor/nurse/clinic (GI...
visitdoc_res   948      2  .1276371      0      1  Visited doctor/nurse/clinic (Re...
visitdoc_skn   270      2  .1518519      0      1  Visited doctor/nurse/clinic (Sk...
vomitingstdt   168     76  15911.33  15850  15960  vomiting start date
watertime     8236     91   63.7778      0    900  Time in water (mins)
wave          8797      2  .0056838      0      1  boog board/wave rid/surf/windsu...
-------------------------------------------------------------------------------------

. 
. log close
      name:  <unnamed>
       log:  /Users/jadederong/Documents/CRG/coliphage/13beaches-coliphage/src/dm/3-f
> ormat-mb-epi.log
  log type:  text
 closed on:  14 Jan 2016, 16:44:57
-------------------------------------------------------------------------------------
